<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>B4J - DBUtils Example</title>
   
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>
     <link rel="stylesheet" type="text/css" href="index.css" />
    <script src="/b4j_ws.js"></script>
 </head>
 <body>
	<h1>DBUtils Example</h1>
	<div id="main_fields">
        Student ID: <select id="lststudentsid"></select> <br/>
        Name: <span id="lblstudentname"></span><br/>
        Birthday: <span id="lblbirthday"></span><br/>
        Test: <select id="lsttests"></select> <br/>
        Grade: <input type="text" id="txtgrade"></input> <button id="btnsetgrade">Set Grade</button>
     </div>
     <div id="failedtestsDiv">
        <h2>Failed Tests</h2>
        <table id="tblfailedtests">
            <thead>
                <tr>
                    <th>Test</th>
                    <th>Grade</th>
                </tr>
          </thead>
        </table>
     </div>
     <div id="tblDiv">
         <h2>All Students</h2>
        <table id="tblstudents">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Birthday</th>
                </tr>
          </thead>
        </table>
    </div>
	<script>
	$( document ).ready(function() {
        b4j_connect("/dbutils/ws");
    });
    //add selection feature to DataTables: http://datatables.net/examples/api/select_single_row.html
    /***************************************************/
    function addSelectionToTable(id, eventName) {
        
        $(id + " tbody").click(function(event) {
            if (typeof event.target.parentNode._DT_RowIndex != 'undefined') {
                setSelectedRow(id, event.target.parentNode._DT_RowIndex);
                b4j_raiseEvent(eventName.toLowerCase(), {row : event.target.parentNode._DT_RowIndex});
            }
	   });
        
    }
    function setSelectedRow(id, row) {
        var oTable = $(id).dataTable( );
        $(oTable.fnSettings().aoData).each(function (){
            $(this.nTr).removeClass('row_selected');
        });
        var aTrs = oTable.fnGetNodes();
      $(aTrs[row]).addClass('row_selected');
    }
    function getSelectedRow(id) {
        var aReturn = new Array();
        var oTable = $(id).dataTable( );
        var aTrs = oTable.fnGetNodes();
        for ( var i=0 ; i<aTrs.length ; i++ )
        {
            if ( $(aTrs[i]).hasClass('row_selected') )
            {
                return i;
            }
        }
        return -1;
    }
    /**********  dataTable selection feature ******/
	</script>

 </body>
